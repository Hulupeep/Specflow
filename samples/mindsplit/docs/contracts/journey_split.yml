# Journey Contract: Split Meeting Notes
# Definition of Done for core user flow

contract_meta:
  id: journey_split
  version: 1
  created_from_spec: "SPEC.md"
  covers_reqs:
    - J-SPLIT-001
    - J-SPLIT-002
    - J-SPLIT-003
  owner: "product-team"

journeys:
  - id: J-SPLIT-001
    name: "Split Meeting Notes"
    criticality: critical
    blocks_release: true
    status: not_tested

    actor: "user"
    preconditions:
      - "User has text file with meeting notes"
      - "Text contains multiple distinct topics"

    steps:
      - step: 1
        action: "User provides meeting notes"
        command: "mindsplit split notes.txt --streams 3"
        expected: "System accepts input file"

      - step: 2
        action: "System parses into chunks"
        expected: "Each paragraph/bullet becomes a chunk with unique ID"
        validates: "FEAT-001"

      - step: 3
        action: "System builds similarity graph"
        expected: "Graph created with weighted edges above threshold"
        validates: "FEAT-003"

      - step: 4
        action: "System runs min-cut"
        expected: "Graph split into N partitions"
        validates: "FEAT-004"

      - step: 5
        action: "System outputs workstreams"
        expected: "Structured output with chunks grouped by workstream"
        validates: "FEAT-005"

    acceptance_criteria:
      - criteria: "All input chunks appear in exactly one workstream"
        test: "sum(workstream.chunks.length) == input.chunks.length"
      - criteria: "Cut edges are reported"
        test: "result.cutEdges.length >= 0"
      - criteria: "Deterministic output"
        test: "run twice with same seed â†’ identical output"
      - criteria: "No chunk lost"
        test: "all input chunk IDs exist in output"

    test_file: "src/__tests__/journeys/split.test.ts"

  - id: J-SPLIT-002
    name: "Incremental Add"
    criticality: important
    blocks_release: false
    status: not_tested

    actor: "user"
    preconditions:
      - "Previous split session exists"
      - "User has new content to add"

    steps:
      - step: 1
        action: "User adds new content"
        command: "mindsplit add session-123 new-notes.txt"
        expected: "New chunks created"

      - step: 2
        action: "System checks embedding cache"
        expected: "Existing embeddings retrieved from ruvector"
        validates: "ARCH-002"

      - step: 3
        action: "System computes new embeddings only"
        expected: "Only new chunks get embedding computation"

      - step: 4
        action: "System re-runs min-cut"
        expected: "New partitioning with new + old chunks"

      - step: 5
        action: "System shows diff"
        expected: "Changes from previous split highlighted"

    acceptance_criteria:
      - criteria: "Cached embeddings reused"
        test: "embedding_compute_count == new_chunk_count"
      - criteria: "Previous chunks preserved"
        test: "all previous chunk IDs still exist"

    test_file: "src/__tests__/journeys/incremental.test.ts"

  - id: J-SPLIT-003
    name: "Explore Bleeding Edges"
    criticality: important
    blocks_release: false
    status: not_tested

    actor: "user"
    preconditions:
      - "Split has been performed"
      - "Multiple workstreams exist"

    steps:
      - step: 1
        action: "User requests bleeding edge report"
        command: "mindsplit bleeding session-123"
        expected: "Report generated"

      - step: 2
        action: "System lists cut edges"
        expected: "Each edge shows source chunk, target chunk, similarity"

      - step: 3
        action: "System groups by workstream pair"
        expected: "Edges organized by which workstreams they connect"

    acceptance_criteria:
      - criteria: "All cut edges listed"
        test: "report.edges == mincut_result.cutEdges"
      - criteria: "Context provided"
        test: "each edge has chunk text excerpts"

    test_file: "src/__tests__/journeys/bleeding.test.ts"

definition_of_done:
  critical:
    - "J-SPLIT-001 passes"
    - "ARCH-001: Graph functions pure"
    - "ARCH-002: Embeddings cached"
    - "ARCH-003: Deterministic output"

  important:
    - "J-SPLIT-002 passes"
    - "J-SPLIT-003 passes"
    - "ARCH-004: Atomic memory operations"

  future:
    - "FEAT-006: Visualization"
