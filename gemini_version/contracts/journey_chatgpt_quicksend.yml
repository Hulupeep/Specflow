journey_meta:
  id: J-CHATGPT-QUICKSEND
  from_spec: "sample_spec/spec.md"
  covers_reqs:
    - UX-002
    - UX-003
    - MD-001
    - MD-003
  type: "e2e"
  description: "ChatGPT message quick send for configured user"

preconditions:
  - "Extension installed and enabled"
  - "PAT configured in chrome.storage.local"
  - "At least one repo configured"
  - "User has previously used detailed modal and selected 'Don't ask again'"

steps:
  - step: 1
    name: "Open ChatGPT conversation"
    action: "Navigate to ChatGPT conversation page"
    required_elements:
      - selector: "[data-message-author-role='assistant']"
        description: "At least one assistant message present"

  - step: 2
    name: "Locate send button on assistant message"
    action: "Hover over assistant message"
    required_elements:
      - selector: "[data-testid='send-to-repo']"
        description: "Send to repo button injected by extension"
    validation:
      - "Button only appears on assistant messages, not user messages"

  - step: 3
    name: "Click send button"
    action: "Click the 'Send to repo' button"
    expected:
      - type: "no_modal"
        description: "Modal must NOT appear (quick send flow)"
      - type: "message_sent"
        message_type: "perform-capture"
        to: "background"

  - step: 4
    name: "Wait for completion"
    action: "Background processes capture request"
    expected:
      - type: "api_call"
        method: "PUT"
        path_pattern: "/repos/{owner}/{repo}/contents/{path}"
        description: "GitHub API call to create file"

  - step: 5
    name: "Toast feedback"
    action: "System shows result"
    expected:
      - type: "element_visible"
        selector: "[data-testid='toast']"
        contains: "Saved to"
      - type: "element_visible"
        selector: "[data-testid='toast'] a"
        description: "Open in GitHub link"
    validation:
      - "No error toast"
      - "No modal appeared during flow"

  - step: 6
    name: "Verify file in repo"
    action: "Check GitHub repo"
    expected:
      - type: "file_exists"
        path_pattern: "{basePath}/{YYYY}/{MM}/{DD}/{slug}.md"
      - type: "file_content"
        contains:
          - "source: chatgpt"
          - "captured_at:"
          - "tags:"

  - step: 7
    name: "Verify front-matter"
    action: "Parse created file"
    expected:
      - type: "yaml_field"
        field: "source"
        value: "chatgpt"
      - type: "yaml_field"
        field: "captured_at"
        format: "ISO8601"
      - type: "yaml_field"
        field: "tags"
        type: "array"
        contains: ["chatgpt"]

test_hooks:
  e2e_test_file: "sample_spec/__tests__/e2e/chatgpt_quicksend.spec.ts"

acceptance_criteria:
  - "No modal appears during quick send"
  - "Toast shows within 3 seconds of click"
  - "File created in correct path format"
  - "Front-matter has all required fields"
  - "tags is array containing at least 'chatgpt'"
